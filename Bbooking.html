<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TEDxNIFT Jodhpur Booking</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    /* Global Styles from new theme */
    body {
        font-family: 'Inter', sans-serif;
        background-color: #111111;
        color: #E0E0E0;
    }
    .text-ted-red { color: #E62B1E; }
    .bg-ted-red { background-color: #E62B1E; }

    /* Original Booking Styles (adapted) */
    .booking-container {
      background: #1e1e1e;
      border-radius: 12px;
      padding: 24px;
      max-width: 520px; /* Increased width for new fields */
      width: 100%;
      box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
      border: 1px solid #333;
      position: relative;
    }
    .btn-help, .btn-how-to-book {
      position: absolute; top: 16px; padding: 6px 12px;
      border: none; border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer;
      background: #333; color: #fff; text-decoration: none;
    }
    .btn-help { left: 16px; }
    .btn-how-to-book { right: 16px; }

    .header-booking { text-align: center; margin-bottom: 24px; padding-top: 36px; }
    .header-booking h1 {
      font-size: 28px; font-weight: 700; color: #fff;
    }
    .header-booking h1 span { color: #e62b1e; }
    .header-booking p { font-size: 14px; color: #888; margin-top: 4px; letter-spacing: 1px; }
    .event-card {
      background: #2a2a2a; border-radius: 8px; padding: 12px;
      margin-bottom: 16px; display: flex; justify-content: space-between;
      align-items: center; font-size: 14px; border: 1px solid #333;
    }
    .legend {
      display: flex; flex-wrap: wrap; justify-content: center; gap: 12px; font-size: 10px; margin-bottom: 12px;
    }
    .legend-item { display: flex; align-items: center; gap: 4px; color: #aaa; }
    .legend-color { width: 10px; height: 10px; border-radius: 2px; }
    .available { background: #444; }
    .selected  { background: #2980B9; } /* Blue for selected */
    .occupied  { background: #e62b1e; } /* Red for occupied */
    .reserved { background: #f39c12; } /* Yellow for reserved */
    .seating-area {
      background: #2a2a2a; border-radius: 8px; padding: 12px;
      margin-bottom: 16px; display: flex; justify-content: center; border: 1px solid #333;
    }
    .auditorium { display: flex; flex-direction: column; gap: 6px; width: 100%; }
    #seatingChart { width: 100%; max-height: 45vh; overflow-y: auto; padding-right: 5px;}
    .screen {
      background: #e62b1e; color: #fff;
      padding: 6px 12px; border-radius: 4px; text-align: center;
      font-weight: 600; font-size: 12px; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 2px;
    }
    .direction { display: flex; justify-content: space-between; font-size: 10px; margin: 4px 0; color: #888; }
    .direction span {
      background: #333; color: #e0e0e0; padding: 2px 6px; border-radius: 4px;
    }
    .seat-row { display: flex; align-items: center; }
    .row-label {
      width: 14px; text-align: right; margin-right: 4px; font-size: 8px; font-weight: 600; color: #888;
    }
    .seats { display: flex; flex-wrap: nowrap; }
    .seat {
      width: 22px; height: 22px; margin: 1px; border-radius: 3px;
      display: flex; align-items: center; justify-content: center;
      font-size: 8px; font-weight: 600; cursor: pointer;
      background: #444; color: #fff; border: 1px solid #555;
      transition: all 0.15s;
    }
    .seat:hover:not(.occupied) { transform: scale(1.1); background: #555; }
    .seat.selected { background: #2980B9; border-color: #3498db; color: #fff; transform: scale(1.1); }
    .seat.occupied { background: #e62b1e; border-color: #c03b2b; opacity: 0.7; cursor: not-allowed; }
    .seat.reserved { background: #f39c12; border-color: #d35400; cursor: not-allowed; opacity: 0.7; }
    .aisle-horizontal { height: 6px; }
    .aisle-vertical   { width: 6px; }
    @media (max-width: 480px) {
      .seat { width: 18px; height: 18px; font-size: 6px; } /* Adjusted for better fit */
      .row-label { font-size: 6px; margin-right: 2px; }
      .screen { padding: 4px 8px; font-size: 8px; }
      .direction span { font-size: 6px; padding: 1px 4px; }
      #seatingChart { max-height: 40vh; }
    }
    .message {
      padding: 12px; border-radius: 6px; margin-bottom: 12px;
      font-size: 14px; display: none; text-align: center; font-weight: 500;
    }
    .success { background: rgba(39,174,96,0.15); border:1px solid rgba(39,174,96,0.3); color:#27AE60; }
    .error   { background: rgba(230,43,30,0.15); border:1px solid rgba(230,43,30,0.3); color:#e62b1e; }
    
    /* New Booking Form Styles */
    .booking-form {
      background: #2a2a2a; border-radius: 8px; padding: 24px;
      display: none; font-size: 14px; border: 1px solid #333;
    }
    .form-group { position: relative; margin-bottom: 16px; }
    .form-group label { display:block; margin-bottom:8px; font-weight: 500; color: #aaa; }
    .form-group input,
    .form-group select,
    .form-group textarea {
      width:100%; padding: 10px; border-radius:6px; border:1px solid #555;
      background: #333; color:#e0e0e0; font-size:14px;
      transition: all 0.2s ease;
    }
    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline:none; border-color:#e62b1e; box-shadow:0 0 0 3px rgba(230,43,30,0.2);
    }
    .form-group input:read-only {
        background-color: #2d2d2d;
        cursor: not-allowed;
    }
    .terms-group { font-size: 12px; display: flex; align-items: center; gap: 8px; margin-bottom: 16px; color: #aaa;}
    .terms-group a { color: #e62b1e; text-decoration: none;}
    .book-btn {
      width:100%; padding:12px; background: #e62b1e; color:#fff;
      border:none; border-radius:8px; font-size:16px; font-weight:600;
      cursor:pointer; transition:background 0.15s;
    }
    .book-btn:hover { background:#c52115; }
    .book-btn:disabled { background: #555; cursor: not-allowed; }
    
    .modal-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(5px);
      display: none; justify-content: center; align-items: center; z-index: 1000;
    }
    .modal-content {
      background: #1e1e1e; color: #e0e0e0; padding: 25px;
      border-radius: 10px; text-align: left; width: 90%; max-width: 400px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3); border: 1px solid #333;
    }
    .modal-content h3 { margin-bottom: 15px; font-size: 20px; text-align: center; font-weight: 700; color: #fff;}
    .modal-content p, .modal-content li { margin-bottom: 8px; font-size: 14px; line-height: 1.6; color: #aaa; }
    .modal-content ol { list-style-type: decimal; padding-left: 20px; }
    .modal-content strong { color: #e0e0e0; font-weight: 600; }
    .modal-buttons { margin-top: 20px; display: flex; gap: 10px; flex-direction: column; }
    .modal-btn {
      width: 100%; padding: 10px; border-radius: 6px;
      border: none; font-weight: 600; cursor: pointer;
    }
    .payment-qr { width: 150px; height: 150px; margin: 15px auto; border-radius: 8px; display: block; }
    .chat-btn { background-color: #27AE60; color: white; }
    .close-btn, .cancel-btn { background-color: #c0392b; color: white; }
    .submit-payment-btn { background-color: #e62b1e; color: white; }
    .hidden { display: none; }
  </style>
</head>
<body class="antialiased">
<div class="flex flex-col min-h-screen">
  <!-- Header -->
  <header class="sticky top-0 z-50 bg-[#111111] bg-opacity-80 backdrop-blur-sm shadow-lg w-full">
      <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex justify-between items-center py-4">
          <a href="index.html" class="flex items-center space-x-2 flex-shrink-0">
              <span class="font-black text-2xl text-white">TEDx</span><span class="font-bold text-2xl text-ted-red">NIFTJodhpur</span>
          </a>
          
          <!-- Desktop Nav -->
          <div class="hidden md:flex items-center space-x-8">
              <a href="index.html#about" class="text-gray-300 hover:text-white transition-colors font-medium">About</a>
              <a href="index.html#speakers" class="text-gray-300 hover:text-white transition-colors font-medium">Speakers</a>
              <a href="index.html#schedule" class="text-gray-300 hover:text-white transition-colors font-medium">Schedule</a>
              <a href="team.html" class="text-gray-300 hover:text-white transition-colors font-medium">Team</a>
              <a href="index.html#sponsors" class="text-gray-300 hover:text-white transition-colors font-medium">Sponsors</a>
          </div>

          <div class="flex items-center">
              <a href="#booking-area" class="hidden md:block px-6 py-2 bg-white text-black font-semibold rounded-full hover:bg-gray-200 transition-colors">
                  Book Your Seat
              </a>

              <!-- Mobile Menu Button -->
              <button id="mobile-menu-button" class="md:hidden p-2 rounded-md text-gray-300 hover:text-white hover:bg-gray-700">
                  <svg class="h-6 w-6" stroke="currentColor" fill="none" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
                  </svg>
              </button>
          </div>
      </nav>

      <!-- Mobile Menu -->
      <div id="mobile-menu" class="hidden md:hidden">
          <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
              <a href="index.html#about" class="mobile-nav-link block px-3 py-2 rounded-md text-base font-medium text-gray-300 hover:text-white hover:bg-gray-700">About</a>
              <a href="index.html#speakers" class="mobile-nav-link block px-3 py-2 rounded-md text-base font-medium text-gray-300 hover:text-white hover:bg-gray-700">Speakers</a>
              <a href="index.html#schedule" class="mobile-nav-link block px-3 py-2 rounded-md text-base font-medium text-gray-300 hover:text-white hover:bg-gray-700">Schedule</a>
               <a href="team.html" class="mobile-nav-link block px-3 py-2 rounded-md text-base font-medium text-gray-300 hover:text-white hover:bg-gray-700">Team</a>
              <a href="index.html#sponsors" class="mobile-nav-link block px-3 py-2 rounded-md text-base font-medium text-gray-300 hover:text-white hover:bg-gray-700">Sponsors</a>
              <a href="#booking-area" class="mobile-nav-link block w-full text-center mt-2 px-3 py-2 rounded-md text-base font-medium text-black bg-white hover:bg-gray-200">Book Your Seat</a>
          </div>
      </div>
  </header>
  
  <main id="booking-area" class="flex-grow w-full flex items-center justify-center py-12 md:py-16 px-4">
      <div class="booking-container">
        <button class="btn-help">Help</button>
        <button class="btn-how-to-book">How to Book</button>

        <div class="header-booking">
          <h1>TED<span>x</span>NIFT Jodhpur</h1>
          <p>Ideas Worth Spreading</p>
        </div>

        <div class="event-card">
          <div class="event-theme">Annual Flagship Event</div>
          <div class="event-time">10:00 AM</div>
          <div class="event-price">₹<span id="eventPrice">399</span> Early Access</div>
        </div>

        <div class="legend">
          <div class="legend-item"><div class="legend-color available"></div><span>Available</span></div>
          <div class="legend-item"><div class="legend-color reserved"></div><span>Reserved</span></div>
          <div class="legend-item"><div class="legend-color selected"></div><span>Selected</span></div>
          <div class="legend-item"><div class="legend-color occupied"></div><span>Occupied</span></div>
        </div>

        <div class="seating-area">
          <div class="auditorium">
            <div class="screen">STAGE</div>
            <div class="direction"><span>Entrance</span><span>Exit</span></div>
            <div id="seatingChart"></div>
          </div>
        </div>

        <div id="successMessage" class="message success"></div>
        <div id="errorMessage" class="message error"></div>

        <form id="bookingForm" class="booking-form">
            <h2 class="text-xl font-bold text-white mb-6 text-center">Complete Your Booking</h2>
            
            <!-- Common Fields -->
            <div class="form-group">
                <label for="userType">I am a...</label>
                <select id="userType" required>
                    <option value="" selected disabled>Select your category</option>
                    <option value="nift_student">NIFT Student</option>
                    <option value="student">Other Student</option>
                    <option value="other">Other</option>
                </select>
            </div>
            <div class="form-group">
                <label for="name">Full Name</label>
                <input id="name" type="text" required>
            </div>
            <div class="form-group">
                <label for="email">Email Address (for confirmation)</label>
                <input id="email" type="email" required>
            </div>
             <div class="form-group">
                <label for="phone">Phone Number</label>
                <input id="phone" type="tel" required>
            </div>

            <!-- NIFT Student-specific Fields -->
            <div id="niftStudentFields" class="hidden">
                 <div class="form-group">
                    <label for="niftEmail">NIFT Email ID</label>
                    <input id="niftEmail" type="email" placeholder="your.name@nift.ac.in">
                </div>
                 <div class="form-group">
                    <label for="niftStudentId">Student ID</label>
                    <input id="niftStudentId" type="text">
                </div>
                 <div class="form-group">
                    <label for="niftCollegeName">College Name</label>
                    <input id="niftCollegeName" type="text" value="NIFT Jodhpur" readonly>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-4">
                    <div class="form-group">
                        <label for="niftDepartment">Department</label>
                        <select id="niftDepartment">
                            <option value="">Select Dept</option>
                            <option value="AD">AD</option>
                            <option value="BFT">BFT</option>
                            <option value="MFM">MFM</option>
                            <option value="FD">FD</option>
                            <option value="FC">FC</option>
                            <option value="TD">TD</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="niftSemester">Semester</label>
                        <select id="niftSemester">
                             <option value="">Select Sem</option>
                             <option value="1">1</option>
                             <option value="3">3</option>
                             <option value="5">5</option>
                             <option value="7">7</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Student-specific Fields -->
            <div id="studentFields" class="hidden">
                <div class="form-group">
                    <label for="studentId">Student ID</label>
                    <input id="studentId" type="text">
                </div>
                <div class="form-group">
                    <label for="collegeName">College Name</label>
                    <input id="collegeName" type="text">
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-4">
                    <div class="form-group">
                        <label for="department">Department</label>
                        <input id="department" type="text">
                    </div>
                    <div class="form-group">
                        <label for="passingYear">Year of Passing</label>
                        <input id="passingYear" type="number" min="2024">
                    </div>
                </div>
            </div>

            <!-- Other-specific Fields -->
            <div id="otherFields" class="hidden">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-4">
                    <div class="form-group">
                        <label for="idType">ID Type</label>
                        <select id="idType">
                            <option value="">Select ID Type</option>
                            <option value="aadhar">Aadhar Card</option>
                            <option value="dl">Driving License</option>
                            <option value="voterid">Voter ID</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="idNumber">ID Number</label>
                        <input id="idNumber" type="text">
                    </div>
                </div>
                <div class="form-group">
                    <label for="address">Current Address</label>
                    <textarea id="address" rows="3"></textarea>
                </div>
            </div>

            <div class="form-group">
                <label for="seatNumber">Selected Seat</label>
                <input id="seatNumber" type="text" readonly required>
            </div>
            <div class="terms-group">
                <input type="checkbox" id="terms" required>
                <label for="terms">I agree to the <a href="#" onclick="alert('Terms & Conditions: ...')">terms and conditions</a>.</label>
            </div>
            <button type="button" id="payBtn" class="book-btn" disabled>Proceed to Pay</button>
        </form>
      </div>
  </main>
  
  <!-- Footer -->
  <footer class="border-t border-gray-800 py-12 w-full">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
              <div class="md:col-span-1">
                  <a href="index.html" class="flex items-center space-x-2">
                      <span class="font-black text-xl text-white">TEDx</span><span class="font-bold text-xl text-ted-red">NIFTJodhpur</span>
                  </a>
                  <p class="mt-4 text-gray-400 text-sm">This independent TEDx event is operated under license from TED.</p>
                  <p class="mt-4 text-gray-400 text-sm">© 2025 TEDxNIFTJodhpur. All rights reserved.</p>
              </div>
              <div>
                  <h4 class="font-semibold text-white">Navigation</h4>
                  <ul class="mt-4 space-y-2 text-gray-400">
                      <li><a href="index.html#about" class="hover:text-white">About Us</a></li>
                      <li><a href="index.html#speakers" class="hover:text-white">Speakers</a></li>
                      <li><a href="index.html#schedule" class="hover:text-white">Schedule</a></li>
                      <li><a href="team.html" class="hover:text-white">Our Team</a></li>
                  </ul>
              </div>
              <div>
                  <h4 class="font-semibold text-white">Key Contacts</h4>
                  <ul class="mt-4 space-y-2 text-gray-400">
                      <li><a href="mailto:akarshan.agrawal09@gmail.com" class="hover:text-white">Akarshan Agrawal (Licensee)</a></li>
                      <li><a href="mailto:tanisha.gupta3@nift.ac.in" class="hover:text-white">Tanisha Gupta (Organizer)</a></li>
                      <li><a href="mailto:shruti.khinvasara@nift.ac.in" class="hover:text-white">Shruti Khinvansara (Co-organizer)</a></li>
                      <li><a href="mailto:chyasar2004@gmail.com" class="hover:text-white">Yasar CH (Web & Registration)</a></li>
                      <li class="pt-2"><a href="mailto:tedxnift.jodhpur@nift.ac.in" class="hover:text-white font-semibold">Official Email</a></li>
                  </ul>
              </div>
              <div>
                  <h4 class="font-semibold text-white">Legal</h4>
                  <ul class="mt-4 space-y-2 text-gray-400">
                      <li><a href="legal.html" class="hover:text-white">Contact Us</a></li>
                      <li><a href="legal.html" class="hover:text-white">Privacy Policy</a></li>
                      <li><a href="legal.html" class="hover:text-white">Terms and Conditions</a></li>
                      <li><a href="legal.html" class="hover:text-white">Refund/Cancellation Policy</a></li>
                  </ul>
              </div>
          </div>
      </div>
  </footer>
</div>

<!-- How to Book Modal -->
<div id="howToBookModal" class="modal-overlay">
  <div class="modal-content">
    <h3>How to Book Your Seat</h3>
    <ol>
        <li><strong>Select a Seat:</strong> Click on any <strong class="text-gray-400">grey (Available)</strong> seat from the chart. Your chosen seat will turn <strong class="text-blue-400">blue (Selected)</strong>.</li>
        <li><strong>Fill Your Details:</strong> The booking form will appear. Select your category (Student/Other) and fill in all the required details.</li>
        <li><strong>Agree to Terms:</strong> Read and accept the terms and conditions by checking the box.</li>
        <li><strong>Proceed to Pay:</strong> Click the "Proceed to Pay" button. A payment pop-up will appear.</li>
        <li><strong>Complete Payment:</strong> Scan the QR code to pay and enter the Transaction ID (UTR) in the provided field.</li>
        <li><strong>Submit & Confirm:</strong> Click "Submit". Your booking details will be submitted for verification.</li>
        <li><strong>Verification:</strong> We will check your details and send a confirmation email with your ticket to you within <strong>2-4 hours</strong>.</li>
    </ol>
    <div class="modal-buttons">
      <button id="closeHowToBookBtn" class="modal-btn close-btn">Got It!</button>
    </div>
  </div>
</div>

 <!-- Help Modal -->
 <div id="helpModal" class="modal-overlay">
  <div class="modal-content">
    <h3>Developer Info</h3>
    <p><strong>Name:</strong> Yasar C H</p>
    <p><strong>Department:</strong> BFT</p>
    <p><strong>Batch:</strong> 27</p>
    <p><strong>WhatsApp:</strong> 8157980825</p>
    <div class="modal-buttons">
      <button id="chatNowBtn" class="modal-btn chat-btn">Chat Now</button>
      <button id="closeHelpModalBtn" class="modal-btn close-btn">Close</button>
    </div>
  </div>
</div>

 <!-- Payment Modal -->
 <div id="paymentModal" class="modal-overlay">
  <div class="modal-content">
    <h3>Complete Your Payment</h3>
    <p class="text-center text-lg font-bold text-white mb-2">Amount to Pay: ₹<span id="paymentAmount">399</span></p>
    <p class="text-center">Scan the QR code below to pay.</p>
    <p id="qrCodeInfo" class="text-center text-sm text-gray-400 mb-2"></p>
    <img id="paymentQrImage" src="https://placehold.co/150x150/ffffff/000000?text=SCAN" alt="Payment QR Code" class="payment-qr">
    <div class="form-group">
      <label for="utr">Enter UTR / Transaction ID</label>
      <input id="utr" type="text" placeholder="Enter payment reference number" required>
    </div>
    <div class="modal-buttons">
      <button id="submitPaymentBtn" class="modal-btn submit-payment-btn">Submit</button>
      <button id="cancelPaymentBtn" class="modal-btn cancel-btn">Cancel</button>
    </div>
  </div>
</div>

<!-- Confirmation Modal -->
<div id="confirmationModal" class="modal-overlay">
  <div class="modal-content">
    <h3 class="text-green-400">Booking Submitted!</h3>
    <p>Thank you! Your booking details have been received successfully.</p>
    <p>We will now verify your payment and information. A final confirmation email with your e-ticket will be sent to your registered email address within <strong>2-4 hours</strong>.</p>
    <p class="mt-4 text-sm text-center">Your Ticket ID is: <strong id="modalTicketId" class="text-white"></strong></p>
    <div class="modal-buttons">
      <button id="closeConfirmationBtn" class="modal-btn submit-payment-btn">OK</button>
    </div>
  </div>
</div>
  
  <script>
      // Mobile menu toggle
      const mobileMenuButton = document.getElementById('mobile-menu-button');
      const mobileMenu = document.getElementById('mobile-menu');
      const mobileNavLinks = document.querySelectorAll('.mobile-nav-link');

      mobileMenuButton.addEventListener('click', () => {
          mobileMenu.classList.toggle('hidden');
      });

      // Close mobile menu when a link is clicked
      mobileNavLinks.forEach(link => {
          link.addEventListener('click', () => {
              mobileMenu.classList.add('hidden');
          });
      });
  </script>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.2/firebase-app.js";
    import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/9.17.2/firebase-database.js";

    const firebaseConfig = {
      // THIS IS A DEMO KEY AND WILL BE REPLACED
      apiKey: "AIzaSyBpew8ODVHmmGndhZxQ3VK_CEurW0_EQyU",
      authDomain: "nift-movie-nigt-apc.firebaseapp.com",
      databaseURL: "https://nift-movie-nigt-apc-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "nift-movie-nigt-apc",
      storageBucket: "nift-movie-nigt-apc.appspot.com",
      messagingSenderId: "736122244542",
      appId: "1:736122244542:web:69d88050a26fc8391dbdef",
      measurementId: "G-GL1MBM6DW6"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const generalQrCodeUrls = [
      "https://placehold.co/150x150/ffffff/E62B1E?text=QR+PAY+399+A",
      "https://placehold.co/150x150/ffffff/E62B1E?text=QR+PAY+399+B",
      "https://placehold.co/150x150/ffffff/E62B1E?text=QR+PAY+399+C",
      "https://placehold.co/150x150/ffffff/E62B1E?text=QR+PAY+399+D",
      "https://placehold.co/150x150/ffffff/E62B1E?text=QR+PAY+399+E"
    ];
    const niftQrCodeUrls = [
      "https://placehold.co/150x150/ffffff/E62B1E?text=QR+PAY+199+N1",
      "https://placehold.co/150x150/ffffff/E62B1E?text=QR+PAY+199+N2",
      "https://placehold.co/150x150/ffffff/E62B1E?text=QR+PAY+199+N3",
      "https://placehold.co/150x150/ffffff/E62B1E?text=QR+PAY+199+N4"
    ];

    let selectedSeat = null;
    let selectedSeatElement = null;
    let lastUsedQrIndex = null; // Variable to track the last shown QR code index

    document.addEventListener("DOMContentLoaded", () => {
      const seatingChart = document.getElementById("seatingChart");
      const bookingForm = document.getElementById("bookingForm");
      const successMsg = document.getElementById("successMessage");
      const errorMsg = document.getElementById("errorMessage");
      const payBtn = document.getElementById("payBtn");
      const termsCheckbox = document.getElementById("terms");
      
      // Modals
      const helpModal = document.getElementById("helpModal");
      const paymentModal = document.getElementById("paymentModal");
      const howToBookModal = document.getElementById("howToBookModal");
      const confirmationModal = document.getElementById("confirmationModal");

      // Modal Buttons
      const helpBtn = document.querySelector(".btn-help");
      const howToBookBtn = document.querySelector(".btn-how-to-book");
      const chatNowBtn = document.getElementById("chatNowBtn");
      const closeHelpModalBtn = document.getElementById("closeHelpModalBtn");
      const closeHowToBookBtn = document.getElementById("closeHowToBookBtn");
      const closeConfirmationBtn = document.getElementById("closeConfirmationBtn");

      // Dynamic Form Fields
      const userTypeSelect = document.getElementById('userType');
      const studentFields = document.getElementById('studentFields');
      const otherFields = document.getElementById('otherFields');
      const niftStudentFields = document.getElementById('niftStudentFields'); // New NIFT fields

      // 'How to Book' Modal Logic
      howToBookBtn.addEventListener("click", () => { howToBookModal.style.display = "flex"; });
      closeHowToBookBtn.addEventListener("click", () => { howToBookModal.style.display = "none"; });

      // Help Modal Logic
      helpBtn.addEventListener("click", () => { helpModal.style.display = "flex"; });
      closeHelpModalBtn.addEventListener("click", () => { helpModal.style.display = "none"; });
      chatNowBtn.addEventListener("click", () => {
        window.open("https://wa.me/8157980825", "_blank");
        helpModal.style.display = "none";
      });

      // Confirmation Modal Logic
      closeConfirmationBtn.addEventListener("click", () => { confirmationModal.style.display = "none"; });

      // Payment Modal Logic
      const submitPaymentBtn = document.getElementById("submitPaymentBtn");
      const cancelPaymentBtn = document.getElementById("cancelPaymentBtn");
      payBtn.addEventListener("click", handlePayNow);
      cancelPaymentBtn.addEventListener("click", () => { paymentModal.style.display = "none"; });
      submitPaymentBtn.addEventListener("click", handleFormSubmit);

      // Close modals on overlay click
      window.addEventListener("click", (event) => {
        if (event.target === helpModal) helpModal.style.display = "none";
        if (event.target === paymentModal) paymentModal.style.display = "none";
        if (event.target === howToBookModal) howToBookModal.style.display = "none";
        if (event.target === confirmationModal) confirmationModal.style.display = "none";
      });

      termsCheckbox.addEventListener("change", () => {
        payBtn.disabled = !termsCheckbox.checked;
      });
      
      // Handle user type change to show/hide fields
      userTypeSelect.addEventListener('change', () => {
        const value = userTypeSelect.value;
        
        // Update price display
        const price = (value === 'nift_student') ? 199 : 399;
        document.getElementById('eventPrice').textContent = price;

        studentFields.classList.toggle('hidden', value !== 'student');
        otherFields.classList.toggle('hidden', value !== 'other');
        niftStudentFields.classList.toggle('hidden', value !== 'nift_student');
        
        // Toggle required attributes for validation
        toggleRequired(studentFields, value === 'student');
        toggleRequired(otherFields, value === 'other');
        toggleRequired(niftStudentFields, value === 'nift_student');
      });

      function toggleRequired(container, isRequired) {
        container.querySelectorAll('input, select, textarea').forEach(input => {
            // Do not toggle 'required' for readonly fields
            if (input.hasAttribute('readonly')) return;

            if (isRequired) {
                input.setAttribute('required', '');
            } else {
                input.removeAttribute('required');
            }
        });
      }

      onValue(ref(db, "seats/"), snapshot => {
        renderSeating(snapshot.val() || {});
      });

      function renderSeating(data) {
        seatingChart.innerHTML = "";
        const rows = ['A','B','C','D','E','F','G','H'];
        rows.forEach((r, ri) => {
          if (ri === 4) {
            const aisleH = document.createElement("div");
            aisleH.className = "aisle-horizontal";
            seatingChart.appendChild(aisleH);
          }
          const rowDiv = document.createElement("div");
          rowDiv.className = "seat-row";
          const label = document.createElement("div");
          label.className = "row-label";
          label.textContent = r;
          rowDiv.appendChild(label);
          const seatsDiv = document.createElement("div");
          seatsDiv.className = "seats";
          for (let i = 1; i <= 30; i++) {
            if (i === 16) {
              const aisleV = document.createElement("div");
              aisleV.className = "aisle-vertical";
              seatsDiv.appendChild(aisleV);
            }
            const seatEl = document.createElement("div");
            seatEl.className = "seat";
            const seatId = r + i;
            seatEl.textContent = i;
            seatEl.dataset.seat = seatId;
            
            // Reserve rows A and B
            if (r === 'A' || r === 'B') {
                seatEl.classList.add("reserved");
                seatEl.title = "Reserved for Faculty & Staff";
            }

            if (data[seatId]) {
              seatEl.classList.add("occupied");
              seatEl.classList.remove("reserved"); // An occupied seat is no longer reserved
            }

            seatEl.addEventListener("click", () => selectSeat(seatEl, seatId));
            seatsDiv.appendChild(seatEl);
          }
          rowDiv.appendChild(seatsDiv);
          seatingChart.appendChild(rowDiv);
        });
      }

      function selectSeat(el, id) {
        if (el.classList.contains("occupied") || el.classList.contains("reserved")) return;

        if (selectedSeatElement) {
          selectedSeatElement.classList.remove("selected");
        }
        el.classList.add("selected");
        selectedSeat = id;
        selectedSeatElement = el;
        document.getElementById("seatNumber").value = id;
        bookingForm.style.display = "block";
        bookingForm.scrollIntoView({ behavior: "smooth", block: "start" });
      }
      
      function handlePayNow() {
        if (validateForm()) {
          const userType = document.getElementById('userType').value;
          const isNiftStudent = userType === 'nift_student';
          
          const amount = isNiftStudent ? 199 : 399;
          const selectedQrUrls = isNiftStudent ? niftQrCodeUrls : generalQrCodeUrls;

          // Show a random QR code to distribute payments
          const qrIndex = Math.floor(Math.random() * selectedQrUrls.length);
          lastUsedQrIndex = qrIndex; // Store the index of the QR code being shown
          const paymentQrImage = document.getElementById('paymentQrImage');
          const qrCodeInfo = document.getElementById('qrCodeInfo');
          
          document.getElementById('paymentAmount').textContent = amount;
          paymentQrImage.src = selectedQrUrls[qrIndex];
          qrCodeInfo.textContent = `Paying with QR ${isNiftStudent ? 'NIFT-' : 'GEN-'}${qrIndex + 1}`;
          
          paymentModal.style.display = 'flex';
        }
      }
      
      function validateForm() {
         // Check if all required fields visible in the form are filled
        let isValid = true;
        const requiredInputs = bookingForm.querySelectorAll('[required]');
        
        requiredInputs.forEach(input => {
            const isHidden = input.closest('.hidden');
            if (!isHidden) { // Only validate visible fields
                if (!input.value.trim()) {
                    const label = input.closest('.form-group').querySelector('label')?.textContent || 'A required field';
                    showError(`'${label}' is empty.`);
                    isValid = false;
                }
            }
        });

        if (!isValid) return false;

        const email = document.getElementById("email").value.trim();
        const phone = document.getElementById("phone").value.trim();

        if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
          showError("Please enter a valid email address.");
          return false;
        }
        if (!/^\d{10}$/.test(phone)) {
          showError("Invalid phone number. Must be 10 digits.");
          return false;
        }

        // NIFT Student specific validation
        if (document.getElementById('userType').value === 'nift_student') {
            const niftEmail = document.getElementById('niftEmail').value.trim();
            if (!niftEmail.toLowerCase().endsWith('@nift.ac.in')) {
                showError("Please use a valid NIFT email ending with '@nift.ac.in'.");
                return false;
            }
        }
        
        return true;
      }

      async function handleFormSubmit() {
        const utr = document.getElementById("utr").value.trim();
        if (!utr) {
          showError("Please enter the UTR/Transaction ID.");
          return;
        }

        const userType = document.getElementById("userType").value;
        const isNiftStudent = userType === 'nift_student';

        const commonData = {
          userType: userType,
          name: document.getElementById("name").value.trim(),
          email: document.getElementById("email").value.trim(),
          phone: document.getElementById("phone").value.trim(),
          seatNumber: selectedSeat,
          utr: utr,
          // Corrected the paymentQR string to be more descriptive
          paymentQR: lastUsedQrIndex !== null ? `QR ${isNiftStudent ? 'NIFT-' : 'GEN-'}${lastUsedQrIndex + 1}` : 'N/A'
        };

        let specificData = {};
        if (commonData.userType === 'student') {
            specificData = {
                studentId: document.getElementById("studentId").value.trim(),
                collegeName: document.getElementById("collegeName").value.trim(),
                department: document.getElementById("department").value.trim(),
                passingYear: document.getElementById("passingYear").value.trim()
            };
        } else if (commonData.userType === 'nift_student') {
            // This section now correctly gathers NIFT Student specific data, including the Student ID.
            specificData = {
                studentId: document.getElementById("niftStudentId").value.trim(),
                niftEmail: document.getElementById("niftEmail").value.trim(),
                collegeName: "NIFT Jodhpur",
                department: document.getElementById("niftDepartment").value,
                semester: document.getElementById("niftSemester").value
            };
        } else if (commonData.userType === 'other') {
            specificData = {
                idType: document.getElementById("idType").value,
                idNumber: document.getElementById("idNumber").value.trim(),
                address: document.getElementById("address").value.trim()
            };
        }

        const formData = { ...commonData, ...specificData };
        const ticketId = `TEDX-${formData.seatNumber}-${Date.now().toString().slice(-6)}`;
        formData.ticketId = ticketId;

        const price = formData.userType === 'nift_student' ? 199 : 399;

        try {
          await set(ref(db, `seats/${selectedSeat}`), {
            status: "pending", // Changed from "occupied" to "pending" to fit admin workflow
            price: price, // Use dynamic price
            ...formData,
            timestamp: new Date().toISOString()
          });
          selectedSeatElement.classList.remove("selected");
          selectedSeatElement.classList.add("occupied");
          bookingForm.reset();
          bookingForm.style.display = "none";
          studentFields.classList.add('hidden');
          otherFields.classList.add('hidden');
          niftStudentFields.classList.add('hidden');
          paymentModal.style.display = "none";
          selectedSeat = selectedSeatElement = null;
          payBtn.disabled = true;
          termsCheckbox.checked = false;
          
          // Show confirmation pop-up
          document.getElementById('modalTicketId').textContent = ticketId;
          confirmationModal.style.display = 'flex';

        } catch(err) {
          showError("Booking failed. Please try again.");
          console.error(err);
        }
      }

      function showSuccess(msg) {
        successMsg.innerHTML = msg;
        successMsg.style.display = "block";
        window.scrollTo({ top: successMsg.offsetTop - 100, behavior: 'smooth' });
        setTimeout(() => {
          successMsg.style.display = "none";
          successMsg.innerHTML = "";
        }, 8000);
      }

      function showError(msg) {
        errorMsg.textContent = msg;
        errorMsg.style.display = "block";
        window.scrollTo({ top: errorMsg.offsetTop - 100, behavior: 'smooth' });
        setTimeout(() => {
          errorMsg.style.display = "none";
        }, 4000);
      }
    });
  </script>
</body>
</html>






