<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
<title>Interstellar Movie Night Booking</title>
<style>
  :root {
    --primary-color: #ffcc00;
    --text-light: #fff;
    --text-dark: #111;
    --bg-light: #f7f7f7;
    --bg-dark: #101820;
    --seat-available: #6c757d;
    --seat-selected: #28a745;
    --seat-occupied: #dc3545;

    /* Responsive touch target sizes */
    --base-touch-size: max(24px, 2.5vw);
    --touch-spacing: max(4px, 0.5vw);
  }

  * { box-sizing: border-box; margin:0; padding:0; }

  body {
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    background-color: var(--bg-dark);
    color: var(--text-light);
    transition: background 0.3s, color 0.3s;
    -webkit-tap-highlight-color: transparent;
  }
  body.light-mode {
    background-color: var(--bg-light);
    color: var(--text-dark);
  }

  /* Toggle buttons for theme and reading mode */
  .accessibility-toolbar {
    position: fixed; top:1rem; right:1rem; display:flex; flex-direction:column; gap:0.4rem; z-index:1000;
  }
  .accessibility-btn {
    background: var(--primary-color);
    border:none; padding:8px 12px; border-radius:5px; cursor:pointer; font-size:12px; font-weight:600;
    min-width:80px; display:flex; align-items:center; justify-content:center;
  }
  .accessibility-btn:hover { background:#e6b800; }

  .container {
    max-width:960px; margin:auto; padding:1rem;
  }

  h1 { font-size: calc(1.5rem + 1vw); margin-bottom:0.4rem; text-align:center; font-weight:600; }
  p { font-size:0.9rem; margin:2px; text-align:center; color:#bbb; }

  .movie-details {
    text-align:center; margin:1rem 0; background: rgba(255,255,255,0.05); padding:1rem; border-radius:8px;
  }
  body.light-mode .movie-details { background: rgba(0,0,0,0.05); }

  h2 { font-size:1.2rem; margin:0; color: var(--primary-color); }

  /* Legend outside seating for clarity */
  .legend {
    display: flex; justify-content: center; gap:15px; margin:1.5rem 0; flex-wrap:wrap;
  }
  .legend div { display:flex; align-items:center; gap:0.4rem; font-size:0.9rem; padding:5px 10px; background:rgba(255,255,255,0.1); border-radius:15px; }
  body.light-mode .legend div { background: rgba(0,0,0,0.1); }
  .box { width:16px; height:16px; border-radius:3px; }

  .available { background: var(--seat-available); }
  .selected { background: var(--seat-selected); }
  .occupied { background: var(--seat-occupied); }

  /* Seating chart styles */
  #seatingChart {
    display: flex; flex-direction: column; align-items:center; gap:var(--touch-spacing);
    margin:1.5rem 0;
  }
  .row {
    display:flex; gap:var(--touch-spacing);
  }
  .gap-row { height: calc(var(--base-touch-size)/2); }

  /* Seats styling with adaptive sizes and minimums */
  .seat {
    width: var(--base-touch-size);
    height: var(--base-touch-size);
    min-width:24px; min-height:24px;
    font-size: clamp(8px,1.5vw,12px);
    background-color: var(--seat-available);
    color: var(--text-light);
    border-radius:6px;
    display:flex; align-items:center; justify-content:center;
    cursor:pointer; transition:all 0.2s; outline:none;
  }
  .seat:active { transform:scale(0.95); }
  .seat:hover, .seat:focus {
    transform: scale(1.1); outline:2px solid var(--primary-color);
  }
  .seat.selected { background: var(--seat-selected); box-shadow:0 0 15px rgba(40,167,69,0.6); }
  .seat.occupied { background: var(--seat-occupied); cursor:not-allowed; opacity:0.7; }
  
  /* Gap (empty space) seats for layout */
  .gap-seat {
    width: var(--base-touch-size);
    height: var(--base-touch-size);
    background: transparent;
    min-width:24px; min-height:24px;
  }

  /* Screen style */
  .screen {
    margin:25px auto; padding:1rem; width:85%; text-align:center; font-weight:bold;
    background:#e4e4e4; border-radius:8px; box-shadow:0 4px 15px rgba(0,0,0,0.3);
    font-size:1rem; color:#222;
  }
  body.light-mode .screen { background:#ddd; color:#111; }

  /* Booking form styles */
  #bookingForm {
    display:none; margin:2rem auto; padding:1.5rem; border-radius:10px;
    background: rgba(255,255,255,0.05); width:90%; max-width:400px; backdrop-filter:blur(10px);
  }
  body.light-mode #bookingForm { background: rgba(0,0,0,0.05); }

  #bookingForm h3 { margin-bottom:1rem; text-align:center; color:var(--primary-color); font-size:1.3rem; font-weight:600; }

  #bookingForm input, #bookingForm select {
    width:100%; padding:1rem; margin-bottom:1rem; border:none; border-radius:6px; background:#222; color:#fff; font-size:1rem;
  }
  body.light-mode #bookingForm input, body.light-mode #bookingForm select {
    background:#eee; color:#000;
  }

  #bookingForm button {
    width:100%; padding:1rem; font-size:1.1rem; background-color:var(--primary-color); border:none; border-radius:8px; cursor:pointer;
  }
  #bookingForm button:hover { background:#e6b800; }

  /* Messages */
  #successMessage, #errorMessage {
    display:none; text-align:center; padding:1rem; margin-top:1.5rem; border-radius:8px; font-weight:600; font-size:1rem;
  }
  #successMessage { background: var(--seat-selected); color:#fff; }
  #errorMessage { background: var(--seat-occupied); color:#fff; }

  /* Responsive adjustments for tiny screens */
  @media(max-width: 320px){ :root { --base-touch-size: max(28px,3vw); } }
  @media(min-width:321px) and(max-width:480px) { :root { --base-touch-size: max(32px,3.2vw); } }
  @media(min-width:481px) and(max-width:768px){ :root { --base-touch-size: max(36px,3.5vw); } }
  @media(min-width:769px) and(max-width:1024px){ :root { --base-touch-size: max(40px,3.8vw); } }
  @media(min-width:1025px){ :root { --base-touch-size: max(44px,4vw); } }

  /* Additional adjustments for very small devices */
  @media(max-width:360px){ .seat { font-size:8px; } }
</style>
</head>
<body>

<!-- Accessibility controls -->
<div class="accessibility-toolbar">
  <button class="accessibility-btn" id="themeToggle" aria-label="Toggle dark and light mode">🌙 Dark</button>
  <button class="accessibility-btn" id="readingModeBtn" aria-label="Toggle reading mode">👓 Reading</button>
</div>

<!-- Announcements for screen readers -->
<div id="politeAnnouncement" aria-live="polite" aria-atomic="true" class="announcement-area"></div>
<div id="assertiveAnnouncement" aria-live="assertive" aria-atomic="true" class="announcement-area"></div>

<!-- Main content -->
<div class="container">

<h1>Interstellar Movie Night</h1>
<p>Adventure & Photography Club</p>
<p>NIFT Jodhpur</p>

<div class="movie-details">
  <h2>Show: 9:15 PM | ₹29 per seat</h2>
</div>

<!-- Legend of seats -->
<div class="legend" role="group" aria-label="Seat availability legend">
  <div><div class="box available"></div>Available</div>
  <div><div class="box selected"></div>Selected</div>
  <div><div class="box occupied"></div>Occupied</div>
</div>

<!-- Seating chart -->
<div id="seatingChart" role="application" aria-label="Movie theater seating chart"></div>

<!-- Screen -->
<div class="screen">Screen</div>

<!-- Feedback messages -->
<div id="successMessage"></div>
<div id="errorMessage"></div>

<!-- Booking Form -->
<form id="bookingForm" aria-label="Booking form for selected seat">
  <h3>Booking Details</h3>
  <input type="text" id="name" placeholder="Your Name" required aria-label="Your full name"/>
  <select id="department" required aria-label="Your Department">
    <option value="" disabled selected>Department</option>
    <option value="AD">AD</option>
    <option value="BDT">BFT</option>
    <option value="FC">FC</option>
    <option value="FD">FD</option>
    <option value="MFM">MFM</option>
    <option value="TD">TD</option>
    <option value="STAFF">Staff</option>
    <option value="FACULTY">Faculty</option>
    <option value="OTHER">Other</option>
  </select>
  <select id="semester" required aria-label="Your Semester">
    <option value="" disabled selected>Semester</option>
    <option value="1">1</option><option value="2">2</option>
    <option value="3">3</option><option value="4">4</option>
    <option value="5">5</option><option value="6">6</option>
    <option value="7">7</option><option value="8">8</option>
    <option value="OTHER">Other</option>
  </select>
  <select id="snacks" required aria-label="Snacks">
    <option value="" disabled selected>Do you need snacks?</option>
    <option value="yes">Yes</option>
    <option value="no">No</option>
  </select>
  <input type="email" id="email" placeholder="Email" required aria-label="Your Email"/>
  <input type="text" id="phone" placeholder="Phone (10 digits)" required aria-label="Your 10 digit Phone"/>
  <input type="text" id="seatNumber" disabled aria-label="Selected seat"/>
  <button type="submit" aria-label="Book Seat">Book Now</button>
</form>
</div>

<!-- Scripts -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.2/firebase-app.js";
  import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/9.17.2/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBpew8ODVHmmGndhZxQ3VK_CEurW0_EQyU",
    authDomain: "nift-movie-nigt-apc.firebaseapp.com",
    databaseURL: "https://nift-movie-nigt-apc-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "nift-movie-nigt-apc",
    storageBucket: "nift-movie-nigt-apc.appspot.com",
    messagingSenderId: "736122244542",
    appId: "1:736122244542:web:69d88050a26fc8391dbdef",
    measurementId: "G-GL1MBM6DW6"
  };
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  let selectedSeat = null;

  // Utility for announcements
  const announce = (id, msg) => {
    document.getElementById(id).textContent=msg;
    setTimeout(()=>{document.getElementById(id).textContent='';}, 100);
  };

  // Theme toggle button
  document.getElementById('themeToggle').onclick=()=>{
    document.body.classList.toggle('light-mode');
    const isLight = document.body.classList.contains('light-mode');
    document.getElementById('themeToggle').textContent=isLight ? '🌙 Dark' :'☀️ Light';
    announce('politeAnnouncement', 'Theme switched');
  };

  // Reading mode toggle
  document.getElementById('readingModeBtn').onclick=()=>{
    document.body.classList.toggle('reading-mode');
    const isReading= document.body.classList.contains('reading-mode');
    document.getElementById('readingModeBtn').textContent=isReading ? '👓 Normal' :'👓 Reading';
    announce('politeAnnouncement','Reading mode toggled');
  };

  // Load existing seats
  const seatRef = ref(db, 'seats/');
  onValue(seatRef, snap => {
    const seats = snap.val()||{};
    const chartDiv=document.getElementById('seatingChart');
    chartDiv.innerHTML='';

    const rows=8, seatsPerRow=30;
    for(let i=0; i<rows; i++){
      if(i===4){
        const gapDiv=document.createElement('div');
        gapDiv.className='gap-row';
        chartDiv.appendChild(gapDiv);
      }
      const rowDiv=document.createElement('div');
      rowDiv.className='row';

      for(let j=seatsPerRow-1; j>=0; j--){
        if(j===15){
          const gapSeat=document.createElement('div');
          gapSeat.className='gap-seat';
          rowDiv.appendChild(gapSeat);
        }

        const seatId=`${String.fromCharCode(65+i)}${j+1}`;
        const seatBtn=document.createElement('button');
        seatBtn.className='seat';
        seatBtn.setAttribute('role','button');
        seatBtn.setAttribute('type','button');
        seatBtn.setAttribute('aria-label',`Seat ${seatId} available`);
        seatBtn.dataset.seatId=seatId;
        seatBtn.textContent=seatId;

        if(seats[seatId]){
          seatBtn.classList.add('occupied');
          seatBtn.setAttribute('aria-label',`Seat ${seatId} occupied`);
          seatBtn.disabled=true;
        }

        seatBtn.onclick=()=>{
          if(!seatBtn.classList.contains('occupied')){
            if(selectedSeat) {
              selectedSeat.classList.remove('selected');
              selectedSeat.setAttribute('aria-label',`Seat ${selectedSeat.dataset.seatId} available`);
            }
            seatBtn.classList.add('selected');
            seatBtn.setAttribute('aria-label',`Seat ${seatId} selected`);
            selectedSeat=seatBtn;
            document.getElementById('seatNumber').value=seatId;
            document.getElementById('bookingForm').style.display='block';
            document.getElementById('name').focus();
          }
        };

        seatBtn.onkeydown=(e)=>{
          if(e.key==='Enter'||e.key===' '){
            e.preventDefault();
            seatBtn.click();
          }
        };
        rowDiv.appendChild(seatBtn);
      }
      chartDiv.appendChild(rowDiv);
    }
  });

  // Book seat
  document.getElementById('bookingForm').onsubmit=()=>{
    const btn=document.querySelector('#bookingForm button');
    btn.disabled=true;
    btn.textContent='Booking...';

    const name=document.getElementById('name').value;
    const dept=document.getElementById('department').value;
    const sem=document.getElementById('semester').value;
    const snacks=document.getElementById('snacks').value;
    const email=document.getElementById('email').value;
    const phone=document.getElementById('phone').value;
    const seatId=document.getElementById('seatNumber').value;

    if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)){
      alert('Invalid email');
      document.getElementById('email').focus();
      btn.disabled=false; btn.textContent='Book Now'; return;
    }
    if(!/^\d{10}$/.test(phone)){
      alert('Invalid phone');
      document.getElementById('phone').focus();
      btn.disabled=false; btn.textContent='Book Now'; return;
    }

    set(ref(db, `seats/${seatId}`), {
      status:'occupied',
      name, dept, sem,
      snacks, email, phone
    }).then(()=>{
      if(selectedSeat){
        selectedSeat.classList.remove('selected');
        selectedSeat.classList.add('occupied');
        selectedSeat.setAttribute('aria-label',`Seat ${seatId} occupied`);
        selectedSeat.disabled=true;
      }
      document.getElementById('bookingForm').style.display='none';
      document.getElementById('bookingForm').reset();
      selectedSeat=null;
      document.getElementById('successMessage').innerHTML='Seat booked successfully!';
      document.getElementById('successMessage').style.display='block';

      setTimeout(()=>{
        document.getElementById('successMessage').style.display='none';
        if(snacks==='yes'){
          window.location.href='https://docs.google.com/forms/d/e/1FAIpQLSfhtN9lejsmBoJ7Ux3UYuwjNyYAEKpQFB1-dVrJCpaY1ZWyEQ/viewform?usp=header';
        }
      },3000);
    }).catch(e=>{alert('Error, try again');});
    btn.disabled=false; btn.textContent='Book Now';
    return false;
  };

  // Theme toggle
  document.getElementById('themeToggle').onclick=()=>{
    document.body.classList.toggle('light-mode');
    const isLight=document.body.classList.contains('light-mode');
    document.getElementById('themeToggle').textContent=isLight?'🌙 Dark':'☀️ Light';
  };

  // Reading mode toggle
  document.getElementById('readingModeBtn').onclick=()=>{
    document.body.classList.toggle('reading-mode');
    const isReading=document.body.classList.contains('reading-mode');
    document.getElementById('readingModeBtn').textContent=isReading?'👓 Normal':'👓 Reading';
  };
</script>
</body>
</html>
